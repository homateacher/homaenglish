<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>호마맨 여행 영어</title>
  <style>
    :root{
      --sky1:#e7f1ff; --sky2:#cfe5ff; --sky3:#b7d9ff;
      --ink:#15212e; --mute:#6b7b8c; --line:#d5e6ff;
      --cardA:#ffffff; --cardB:#f3f8ff;
      --accent:#2f6bff; --chip:#eaf0ff; --chip-on:#2f6bff; --chip-on-t:#fff;
      --divider:#dfeaff;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:20px; color:var(--ink);
      font-family: Pretendard, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background:
        radial-gradient(1200px 700px at 20% -10%, #fff8, transparent 40%),
        linear-gradient(180deg, var(--sky1), var(--sky2) 50%, var(--sky3));
      display:flex; flex-direction:column; align-items:center; gap:12px;
    }
    h1{margin:6px 0 4px; font-size:28px; font-weight:800; text-align:center;}
    .toolbar{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center; }
    .toolbar button,.toolbar label{
      border:1px solid var(--line); background:linear-gradient(180deg,#fff,#f3f8ff);
      border-radius:12px; padding:8px 12px; font-size:14px; color:var(--ink);
      box-shadow:0 2px 0 #e4edff inset, 0 1px 2px rgba(0,0,0,.06);
    }

    /* 카테고리 바 */
    .cats{
      display:flex; gap:8px; overflow:auto; padding:6px 2px 2px; max-width: 92vw;
      -webkit-overflow-scrolling: touch;
    }
    .chip{
      border:1px solid var(--line);
      background:var(--chip); color:#2b4aa0;
      padding:8px 12px; border-radius:999px; font-size:13px; font-weight:700; white-space:nowrap;
      cursor:pointer; user-select:none;
    }
    .chip.on{
      background:var(--chip-on); color:var(--chip-on-t); border-color:#2053d9;
      box-shadow:0 1px 0 #e4edff inset, 0 4px 10px rgba(47,107,255,.25);
    }

    .scene{ width:92vw; max-width:740px; height:370px; perspective:1000px; cursor:pointer; }
    .card{
      position:relative; width:100%; height:100%;
      transform-style:preserve-3d; transition:transform .85s cubic-bezier(.22,.75,.2,1);
      border-radius:18px;
    }
    .is-flipped{ transform: rotateY(180deg); }
    .face{
      position:absolute; inset:0; backface-visibility:hidden;
      display:flex; align-items:center; justify-content:center; text-align:center;
      padding:26px; border-radius:18px;
      background:
        repeating-linear-gradient(90deg, transparent 0 6px, #0000 6px),
        linear-gradient(180deg,var(--cardA),var(--cardB));
      box-shadow:
        inset 0 0 0 1px #e7f0ff,
        0 14px 28px rgba(0,0,0,.08), 0 6px 14px rgba(0,0,0,.05);
    }
    .face::before, .face::after{
      content:""; position:absolute; left:12px; right:12px; height:10px;
      background:
        radial-gradient(8px 6px at 0 50%, #9db7ff 45%, transparent 55%),
        radial-gradient(8px 6px at 100% 50%, #9db7ff 45%, transparent 55%),
        repeating-linear-gradient(90deg, transparent 0 6px, #cfe0ff 6px 10px);
      opacity:.45; filter: blur(.2px);
    }
    .face::before{ top:-6px; border-radius:10px 10px 0 0; }
    .face::after{ bottom:-6px; border-radius:0 0 10px 10px; transform:scaleY(-1); }

    #front{ font-size:22px; font-weight:800; letter-spacing:.3px; display:flex; flex-direction:column; gap:8px;}
    #back{ font-size:18px; line-height:1.52; position:relative; }
    .front-note{ font-size:14px; color:var(--mute); }

    /* 2열 레이아웃 */
    .grid{
      width:100%;
      display:grid; grid-template-columns: 1fr 1fr; gap:16px; align-items:start; text-align:left;
    }
    .col{
      background: #fff;
      border:1px solid var(--divider);
      border-radius:12px;
      padding:14px;
      box-shadow: 0 1px 0 rgba(0,0,0,.03) inset;
    }
    .label{
      font-size:12px; font-weight:700; letter-spacing:.6px; color:#4f6fad; text-transform:uppercase;
      margin-bottom:6px;
    }
    .en{ font-size:21px; font-weight:700; margin-bottom:8px; }
    .ko{ font-size:17px; opacity:.95; }

    .cat-badge{
      position:absolute; top:14px; right:14px;
      background:var(--chip); color:#2b4aa0; border:1px solid var(--line);
      padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700;
      box-shadow:0 1px 0 #e4edff inset;
    }

    .meta{ font-size:13px; color:var(--mute); }
    .navs{ display:flex; gap:10px; margin-top:6px; }
    .navs button{
      border:1px solid var(--line); border-radius:12px; padding:8px 14px; font-size:14px;
      background:linear-gradient(180deg,#fff,#f3f8ff); color:var(--ink);
      box-shadow:0 2px 0 #e4edff inset, 0 1px 2px rgba(0,0,0,.06);
    }

    @media (max-width:560px){
      .grid{ grid-template-columns: 1fr; }
      .en{ font-size:20px; }
      .ko{ font-size:16px; }
    }
    @media (max-width:420px){
      #front{ font-size:20px; }
    }
  </style>
</head>
<body>
  <h1>🛫 호마맨 여행 영어</h1>

  <div class="toolbar">
    <button id="shuffle">🔀 셔플</button>
    <button id="flip">↩️ 뒤집기</button>
    <label><input type="checkbox" id="soundToggle" checked /> 사운드</label>
  </div>

  <!-- 카테고리 필터 바 -->
  <div class="cats" id="cats"></div>

  <div class="scene" id="scene" title="카드를 클릭하면 뒤집힙니다">
    <div class="card" id="card">
      <div class="face" id="front">
        <div>오늘의 여행 영어 ✈️</div>
        <div class="front-note">카테고리를 선택하거나 카드를 뒤집어 보세요</div>
      </div>
      <div class="face" id="back" style="transform: rotateY(180deg)"></div>
    </div>
  </div>

  <div class="navs">
    <button id="prev">◀ 이전</button>
    <button id="next">다음 ▶</button>
  </div>
  <div class="meta" id="meta"></div>

  <script>
    const ALL_CATS = ["전체","공항·비행","입국·세관","호텔","교통","길찾기","식당·카페","쇼핑·돈","응급·보건","예의·대화"];

    async function loadData(){
      const res = await fetch('travel_english_500.json', { cache:'no-store' });
      if(!res.ok){ alert('데이터를 불러오지 못했습니다. travel_english_500.json을 확인해 주세요.'); return; }
      const DATA = await res.json();

      // Elements
      const card   = document.getElementById('card');
      const front  = document.getElementById('front');
      const back   = document.getElementById('back');
      const meta   = document.getElementById('meta');
      const soundToggle = document.getElementById('soundToggle');
      const catsEl = document.getElementById('cats');

      // State
      let idx = 0;
      let activeCat = "전체";
      let VIEW = DATA.slice();

      // Build category chips
      ALL_CATS.forEach(cat=>{
        const b = document.createElement('div');
        b.className = 'chip' + (cat==="전체" ? ' on' : '');
        b.textContent = cat;
        b.onclick = ()=>{
          document.querySelectorAll('.chip').forEach(x=>x.classList.remove('on'));
          b.classList.add('on');
          activeCat = cat;
          VIEW = (cat==="전체") ? DATA.slice() : DATA.filter(x=>x.origin===cat);
          if(VIEW.length===0){
            front.innerHTML = `<div>해당 카테고리에 항목이 없습니다.</div>`;
            back.innerHTML = ``;
            meta.textContent = `0/0 — ${activeCat}`;
            idx = 0;
            return;
          }
          idx = 0;
          updateCard();
        };
        catsEl.appendChild(b);
      });

      // flip sound
      function playFlip(){
        if(!soundToggle.checked) return;
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const noise = ctx.createOscillator();
        const gain = ctx.createGain();
        const now = ctx.currentTime;

        osc.type = 'triangle';
        osc.frequency.setValueAtTime(220, now);
        osc.frequency.exponentialRampToValueAtTime(600, now + 0.15);

        noise.type = 'square';
        noise.frequency.setValueAtTime(40, now);
        noise.frequency.exponentialRampToValueAtTime(30, now + 0.15);

        gain.gain.setValueAtTime(0.08, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);

        osc.connect(gain).connect(ctx.destination);
        noise.connect(gain);
        osc.start(now); noise.start(now);
        osc.stop(now + 0.15); noise.stop(now + 0.15);
      }

      const shuffle = (arr)=>{
        for(let i=arr.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          [arr[i],arr[j]]=[arr[j],arr[i]];
        }
        return arr;
      };

      function renderFront(){
        const cur = VIEW[idx];
        front.innerHTML = `<div>${cur.term}</div><div class="front-note">${activeCat} / 탭하여 영어·한국어 보기</div>`;
        meta.textContent = `${idx+1}/${VIEW.length} — ${activeCat}`;
      }
      function renderBack(){
        const cur = VIEW[idx];
        back.innerHTML = `
          <div class="cat-badge">${cur.origin}</div>
          <div class="grid">
            <div class="col">
              <div class="label">EN</div>
              <div class="en">${cur.meaning}</div>
            </div>
            <div class="col">
              <div class="label">KO</div>
              <div class="ko">${cur.ko}</div>
            </div>
          </div>
        `;
        meta.textContent = `${idx+1}/${VIEW.length} — ${activeCat}`;
      }
      function updateCard(){
        if(card.classList.contains('is-flipped')) renderBack(); else renderFront();
        playFlip();
      }

      // 초기 렌더
      renderFront(); renderBack();

      // 인터랙션
      document.getElementById('flip').onclick = ()=>{ card.classList.toggle('is-flipped'); updateCard(); };
      document.getElementById('scene').onclick = ()=>{ card.classList.toggle('is-flipped'); updateCard(); };
      document.getElementById('next').onclick = ()=>{ if(VIEW.length){ idx = (idx+1)%VIEW.length; updateCard(); } };
      document.getElementById('prev').onclick = ()=>{ if(VIEW.length){ idx = (idx-1+VIEW.length)%VIEW.length; updateCard(); } };
      document.getElementById('shuffle').onclick = ()=>{
        shuffle(VIEW);
        idx=0;
        updateCard();
      };

      // 키보드
      window.addEventListener('keydown',(e)=>{
        if(e.key==='ArrowRight') document.getElementById('next').click();
        if(e.key==='ArrowLeft')  document.getElementById('prev').click();
        if(e.key===' '){ e.preventDefault(); document.getElementById('flip').click(); }
      });
    }
    loadData();
  </script>
</body>
</html>
